<?xml version="1.0"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.    
-->
<document>

 <properties>
  <title>James 3.0 - Configuring the SMTP and LMTP Service</title>
 </properties>

<body>

<p>
    <div class="ui-widget">
      <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"> 
        <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 
        <strong>This page still contains text related to James 2.3 and needs to 
        be updated for James 3.0</strong>
		</p>
      </div>
    </div>
</p>


  <section name="SMTP Configuration">
  
     <p>Consult <a href="https://svn.apache.org/repos/asf/james/server/tags/james-server-3.0-M2/container-spring/src/main/config/examples/smtpserver.xml">smtpserver.xml</a> in SVN to get some examples and hints.</p>

    <p>The SMTP service is controlled by a configuration block in the smptserver.xml.
    The smtpserver tag defines the boundaries of the configuration block.  It encloses 
    all the relevant configuration for the SMTP server.  The behavior of the SMTP service is
    controlled by the attributes and children of this tag.</p>
    
    <p>This tag has an optional boolean attribute - <strong>enabled</strong> - that defines whether the service is active or not.  The value defaults to "true" if
    not present.</p>

    <p>The standard children of the smtpserver tag are:</p>
    
    <ul>
      <li><strong>port</strong> - This is an optional integer value.  This value is the port on which this SMTP server is configured 
      to listen.If the tag or value is omitted, the value will default to the standard SMTP port, 25.</li>
      <li><strong>bind</strong> - This is an optional value.  If present, this value is a string describing 
      the IP address to which this service should be bound.  If the tag or value is absent then the service 
      will bind to all network interfaces for the machine.</li>
      <li><strong>useTLS</strong> - This is an optional boolean value.  If this value is true, then the "ssl"
      server socket factory is used to generate the server socket for this service.  If it is false, the 
      "plain" server socket factory is used.  In either case this behavior is overridden by the serverSocketType 
      tag which is described under the expert configuration options.</li>
      <li><strong>handler</strong> - This is an artifact preserved for backwards compatibility.  This tag 
      was used to group related parameters.  It should disappear in future versions.</li>
      <ul>
      <li><strong>helloName</strong> - This is a required tag with an optional body that defines the server name 
      used in the initial service greeting.  The tag may have an optional attribute - <strong>autodetect</strong>.  If 
      the autodetect attribute is present and true, the service will use the local hostname
      returned by the Java libraries.  If autodetect is absent or false, the body of the tag will be used.  In
      this case, if no body is present, the value "localhost" will be used.</li>
      <li><strong>connectionTimeout</strong> - This is an optional tag with a non-negative integer body.  </li>
      <li><strong>authRequired</strong> - This is an optional tag with a boolean body.  If true, then the server will 
      require authentication before delivering mail to non-local email addresses.  If this tag is absent, or the value 
      is false then the client will not be prompted for authentication.  Only simple user/password authentication is
      supported at this time.</li>
      <li><strong>verifyIdentity</strong> - This is an optional tag with a boolean body.  This option can only be used 
      if SMTP authentication is required.  If the parameter is set to true then the sender address for the submitted message
      will be verified against the authenticated subject.</li>
      <li><strong>maxmessagesize</strong> - This is an optional tag with a non-negative integer body.  It specifies the maximum 
      size, in kbytes, of any message that will be transmitted by this SMTP server.  It is a service-wide, as opposed to 
      a per user, limit.  If the value is zero then there is no limit.  If the tag isn't specified, the service will
      default to an unlimited message size.</li>
      </ul>
      </ul>
      <p>There are a few additional children of the smtpserver tag that are appropriate for advanced 
      configurations.  These should only be used by expert administrators.  All tags in this group are optional.</p>
      <ul>
      <li><strong>serverSocketFactory</strong> - This is an optional tag with a string body.  If the tag is present, 
      the body must be the name of one of the server socket factories specified in the socket manager block.  Any other 
      value will result in an error.  If present, this tag overrides the useTLS tag.</li>
      <li><strong>threadGroup</strong> - This is an optional tag with a string body.  If the tag is present, 
      the body must be the name of one of the thread groups specified in the thread manager block.  Any other 
      value will result in an error.  This tag is best used to fine tune thread allocation between the services.</li>
      <li><strong>connectionLimit</strong> - The connectionLimit parameter specifies the maximum number of client 
      connections that this service will allow.  If no value is specified, the value defaults to that specified in 
      the connectionmanager block.  A value of 0 means that there is no limit imposed 
      by the service, although resource limitations imposed by other components 
      (i.e. max # of threads) may serve to limit the number of open connections.</li>
    </ul>
    
    <subsection name="Configure Authenticated SMTP (SMTP AUTH)">
    
      <p>Authenticated SMTP is a method of securing your SMTP server.  With SMTP AUTH enabled senders who wish to 
      relay mail through the SMTP server (that is, send mail that is eventually to be delivered to another SMTP 
      server) must authenticate themselves to James before sending their message.  Mail that is to be delivered 
      locally does not require authentication.  This method ensures that spammers cannot use your SMTP server
      to send unauthorized mail, while still enabling users who may not have fixed IP addresses to send their 
      messages.</p>
      
      <p>Mail servers that allow spammers to send unauthorized email are known as open relays.  So SMTP AUTH
      is a mechanism for ensuring that your server is not an open relay .</p>
      <p>At this time James only supports simple user name / password authentication.</p>
    
      <p>Configuring James for Authentication SMTP is a multi-step process.  It requires several adjustments of 
      the smtpserver.xml.  To enable SMTP AUTH, do the following:</p>
      <p>First, as mentioned above, SMTP AUTH requires that James be able to distinguish between mail intended 
      for local delivery and mail intended for remote delivery.  James makes this determination by matching the 
      domain to which the mail was sent against the &lt;servernames&gt; element of the James configuration block.  Any 
      local domains should be explicitly listed as &lt;servername&gt; elements in this section.</p>
      <p>Second, James is configured out of the box so as to not serve as an open relay for spammers.  This is done 
      by restricting the IP addresses from which mail will be accepted using the RemoteAddrNotInNetwork mailet.  This
      restriction must be lifted before users can send from arbitrary clients.  To do this, comment out or remove the 
      mailet tag containing the class attribute "RemoteAddrNotInNetwork".  This tag can be found in the spoolmanager 
      configuration block, in the root processor configuration.</p>
      <p>Third, set the authRequired element of the smtpserver configuration block to "true".</p>
      <p>Fourth, if you wish to ensure that authenticated users can only send email from their own account, you may
      optionally set the verifyIdentity element of the smtpserver configuration block to "true".</p>
      <p>Fifth, restart James.  This will pull in all of your configuration changes.</p>

      <p>Finally, you need to verify that your configuration was done correctly.  This step is 
      <strong>important</strong> and should not be skipped.</p>
      <p>Verify that you have not inadvertantly configured your server as an open relay. This is most easily 
      accomplished by using the service provided at <a href="http://www.ordb.org">ORDB.org</a>.  ORDB.org will 
      check your mail server and inform you if it is an open relay.</p>
      <p>It is extremely important that your server not be configured as an open relay.  Aside from potential 
      costs associated with usage by spammers, connections from servers that are determined to be open relays 
      are routinely rejected by SMTP servers.  This can severely impede the ability of your mail server to 
      send mail.</p>
      <p>Of course it is also necessary to confirm that users and log in and send 
      mail through your server.  This can be accomplished using any standard mail client (i.e. Outlook, 
      Eudora, Evolution).</p>
      
    </subsection>
    
  </section>
  
  <section name="LMTP Configuration">
    
    <p>Consult <a href="https://svn.apache.org/repos/asf/james/server/tags/james-server-3.0-M2/container-spring/src/main/config/examples/lmtpserver.xml">lmtpserver.xml</a> in SVN to get some examples and hints.</p>

  </section>
    
</body>

</document>
