<?xml version="1.0"?>
<!--
  Licensed to the Apache Software Foundation (ASF) under one
  or more contributor license agreements.  See the NOTICE file
  distributed with this work for additional information
  regarding copyright ownership.  The ASF licenses this file
  to you under the Apache License, Version 2.0 (the
  "License"); you may not use this file except in compliance
  with the License.  You may obtain a copy of the License at

    http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing,
  software distributed under the License is distributed on an
  "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
  KIND, either express or implied.  See the License for the
  specific language governing permissions and limitations
  under the License.    
-->
<document>

 <properties>
  <title>Build James from Source</title>
</properties>

<body>

  <section name="Why Build from Source?">
  
    <p>This step is not necessary to use the standard out of the box version of James.  A 
       pre-built binary version of James is available from the James download directory.</p>
       
     <p>But if you wish to customize the James source code, it will be necessary for you to 
        build the distribution yourself.</p>
  
     <p>You can read on this page how to build from the command line and from eclipse IDE.</p>
     
  </section>
  
  <section name="Get Source Code">
  
    <p>There are two ways to get the James source code.</p>

    <ol>
      <li>Download the source distribution - the source is available from the 
          <a href="http://james.apache.org/download.cgi">James release mirrors</a>.
          Simply choose the version of James you'd like to download, and pick the source 
          distribution appropriate for your platform.</li>
      <li>Get the source code using SVN - this method gives you access to the cutting edge code 
          base.  Instructions on how to use SVN to get the James source code 
          can be found <a href="http://www.apache.org/dev/version-control.html">here</a>.
          James server repository is <a href="http://svn.apache.org/repos/asf/james/server/">here</a>.</li>
    </ol>

    <p>We consider in this document that you have checked-out James source code in JAMES_SRC_HOME directory.</p>

    <p>Consult the <a href="dev.html">architecture</a> page if you want to learn
    more on the internal source structure.</p>

  </section>
  
  <section name="Required Tools">

    <p>To run the build you need two third-party tools.</p>
    <ol>
      <li>Java Development Kit - You must have a JDK of Java version 1.5 or higher installed to build the 
          James distribution.  The exact JDKs available depend on the platform.  A JDK must be downloaded and
          installed before the build can run.</li>
      <li>Maven 2.2.1 - This is a Java-tailored, XML-configured, extensible build or make system. You need ant (2.2.1+) in order
          to build James. You can get maven 2.2.1 from <a href="http://maven.apache.org/download.html">here</a>.
          Installation instructions for maven are also available on the same page <a href="http://maven.apache.org/download.html">http://maven.apache.org/download.html</a>.</li>
    </ol>
    <p>Set (on windows) or export (on Unix) MAVEN-OPTS to tune the memory needed by maven with "MAVEN-OPTS=-Xmx1024m -XX:MaxPermSize=128m"</p>

  </section>
  
  <section name="Build James Source from Command Line">

    <p>In the JAMES_SRC_HOME top level directory (where the parent pom.xml resides), invoke maven with 'mvn' with any of the following command line arguments:
    <ul>
      <li>clean - deletes the target directory, making the system ready for a clean build.</li>
      <li>compile - compiles the source code.</li>
      <li>test - run unit tests for James.</li>
      <li><b>package - generates all the James distributions, packed. From the root directory, cd to 'container-spring/target' to have the build distribution.</b></li>
      <li>javadocs:javadocs - builds the James javadocs.</li>
      <li>site - builds the entirety of the James website.</li>
    </ul>
    </p>
    <p>For example, invoke <code>mvn package</code> to get a zip/tar of James distribution.</p>
    <p>All built products are output in the <code>container-spring/target</code> 
      subdirectory of the James source directory.  
      This directory will be deleted if you run build with the clean argument.</p>
    <p><strong>Warning!</strong> Any changes you've made in the 'dist' directory 
      will be lost after a recompilation. If you are running James fro this directory
      we recommend you backup to avoid losing work. </p>

  </section>

  <section name="Build James Source from Eclipse">
  
    <subsection name="Import projects in Eclipse with m2eclipse">
  
      <p>You should have Eclipse IDE with <a href="http://m2eclipse.sonatype.org">m2eclipse</a> plugin installed.</p>
      <p>You now need to import the maven projects in the Eclipse workspace.</p>
      <p>Therefore, click on the <code>File</code> menu and select <code>Import</code>. 
      Choose <code>Existing Maven Project</code> and click on <code>Next</code> button.</p>
      <img src="./images/eclipse/eclipse-import-maven-view-1.gif" width="300"/>

    </subsection>

    <subsection name="Select Projects to Import">
  
      <p>Select the JAMES_SRC_HOME directory where you have checked out the source code.</p>
      <p>Eclipse should present you with the list of James server modules.</p>
      <p>Select the modules you want to import (by default, all) and click on <code>Finish</code>
        to execute the import.</p>
                
<p>
    <div class="ui-widget">
      <div class="ui-state-error ui-corner-all" style="padding: 0 .7em;"> 
        <p><span class="ui-icon ui-icon-alert" style="float: left; margin-right: .3em;"></span> 
        <strong>The screenshots on this page contain an outdated list of projects. 
         Refer to <a href="http://svn.apache.org/repos/asf/james/server/">http://svn.apache.org/repos/asf/james/server/</a> 
         for the accurate list.</strong>
		</p>
      </div>
    </div>
</p>
        
      <img src="./images/eclipse/eclipse-import-maven-view-2.gif" width="300"/>
      
      <p>You can also import other projects from 
         <a href="http://james.apache.org/imap/source-code.html">imap</a>, 
         <a href="http://james.apache.org/mailbox/source-code.html">mailbox</a>
         and <a href="http://james.apache.org/protocols/source-code.html">protocols</a> to have a 
         more complete view on the used sources code.</p>

    </subsection>

    <subsection name="Enable Workspace Resolution">
  
      <p>Check that 'Workspace resolution' is enable in m2eclipse plugin.</p>
      <p>Your changes in code will be directly taken into account.</p>
      <img src="./images/eclipse/eclipse-m2eclipse-project-dependencies.gif" width="300"/>
    
    </subsection>

    <subsection name="Prepare projects">
  
      <p>Now you have James projects in Eclipse workspace.</p>
      <p>You still have to prepare the following to be able to run from Eclipse:</p>
      <ol>
        <li>Copy the <code>spring-beans.xml</code>, <code>log4j.properties</code> 
            and <code>META-INF/persistence.xml</code>from <code>container-spring\src\main\config\james</code>
             directory to a source folder of <code>container-spring</code> project (you can use for example a 
             new folder called <code>stage</code> as Eclipse source folder).</li>
        <li>Copy all files (except spring-beans.xml, log4j.properties and META-INF/persistence.xml) 
            from <code>container-spring\src\main\config\james</code> folder to a <code>conf</code> folder 
            (<code>conf</code> folder must be a sub-folder of the JAMES_SRC_HOME directory where you made the check-out).</li>
     </ol>
     <img src="./images/eclipse/eclipse-m2eclipse-projects.gif" width="300"/>
    
    </subsection>

    <subsection name="Run James from Eclipse">
  
      <p>That's it. Run or Debug James in Eclipse (right-click on the Main class) and Have Fun!.</p>
      <img src="./images/eclipse/eclipse-run-james.gif" width="300"/>

    </subsection>

  </section>

  <section name="Build James Source from other IDEs">
  
    <p>We will be happy to include on this page any other tutorial you could send 
       use about developing James with your favorite Integrated Development Environment.</p>

  </section>

</body>

</document>
